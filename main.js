(()=>{"use strict";var e="popup_is-animated",t="popup_is-opened",n="card__image",r="card__delete-button",o="card__like-button",a="card__like-button_is-active",i={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},c=function(e,t){e.remove(),e.removeEventListener("click",t)},u=function(e,n){e.classList.remove(t),e.removeEventListener("click",n),document.removeEventListener("keydown",n)},s=function(n,r){n.classList.contains(e)?n.classList.add(t):(setTimeout((function(){n.classList.add(e)}),0),setTimeout((function(){n.classList.add(t)}),10)),n.addEventListener("click",r),document.addEventListener("keydown",r)},l=function(e){return e.find((function(e){return e.popup.classList.contains(t)}))},d=function(e,t){return e.querySelector(".".concat(e.getAttribute("name"),"__").concat(t.name,"--error"))},p=function(e,t){e.hasAttribute("disabled")||(e.setAttribute("disabled",""),e.classList.add(t))},m=function(e,t){e.hasAttribute("disabled")&&(e.removeAttribute("disabled"),e.classList.remove(t))},f=function(e,t){e.setCustomValidity(t)},v=function(e,t,n){n.textContent="",n.classList.remove(t.errorClass),e.classList.remove(t.inputErrorClass)},_=function(e){return e.validity.patternMismatch?e.dataset.patternError?f(e,e.dataset.patternError):console.log("WARNING: error message for pattern is missing in the markup of the input ".concat(e.name)):f(e,""),e.validity.valid},y=function(e){return e.every((function(e){return"INPUT"!==e.nodeName||_(e)}))},h={baseUrl:"https://nomoreparties.co/v1/".concat("wff-cohort-5"),headers:{authorization:"9b1a6b52-28b2-4d5c-8007-f394db7e5a58","Content-Type":"application/json"}},b=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},g=function(e,t){return fetch("".concat(h.baseUrl).concat(e),t).then(b)},C=function(e,t,n){var r=n.commonText,o=void 0===r?"Сохранить":r,a=n.loadingText,i=void 0===a?"Сохранение...":a,c=n.isError,u=void 0!==c&&c,s=n.errorText,l=void 0===s?"ошибка":s,d=t.textContent;return u?("string"!=typeof l&&(l="ошибка"),(l="Повторить ("+l+")").length>30&&(l=l.substring(0,25)+"...)"),t.textContent=l):t.textContent=e?i:o,e?t.setAttribute("disabled",""):t.removeAttribute("disabled"),d};function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var S,L,k=document.querySelector(".profile__info .profile__title"),x=document.querySelector(".profile__info .profile__description"),q=document.querySelector(".profile__image"),T=document.querySelector(".popup_type_edit"),A=document.querySelector(".popup_type_new-card"),N=document.querySelector(".popup_type_avatar"),w=document.querySelector(".popup_type_delete-card"),I=document.querySelector(".popup_type_image"),P=document.querySelector(".popup_type_image .popup__image"),U=document.querySelector(".popup_type_image .popup__caption"),j=document.forms["edit-profile"],O=document.forms["new-place"],B=document.forms["edit-avatar"],D=document.forms["delete-card"],J=document.querySelector("#card-template").content,M=document.querySelector(".places__list"),H=function(e,t,n,r){var o;r?(t.textContent="⌛️",e.classList.contains(a)?function(e){return g("/cards/likes/".concat(e),{method:"DELETE",headers:h.headers})}(n._id).then((function(n){n.likes.some((function(e){return e._id===r}))||e.classList.remove(a),t.textContent=n.likes.length})).catch((function(e){console.error(e),t.textContent="?"})):(o=n._id,g("/cards/likes/".concat(o),{method:"PUT",headers:h.headers})).then((function(n){n.likes.some((function(e){return e._id===r}))&&e.classList.add(a),t.textContent=n.likes.length})).catch((function(e){console.error(e),t.textContent="?"}))):t.textContent=n.likes.length},z=function(e,t,n,r){s(w,V),(L={}).cardElement=e,L.remove=t,L.handle=n,L.card=r},G=function(e,t){var n,r,o;n=e,U.textContent=n.textContent,o=t,(r=P).src=o.src,r.alt=o.alt,s(I,V)},R=function(e){M.prepend(function(e,t){var i=t.removeCard,u=t.likeCard,s=t.showCard,l=t.currentUser,d=t.cardTemplate.querySelector(".card").cloneNode(!0),p=d.querySelector("."+n),m=d.querySelector(".card__title"),f=d.querySelector("."+r),v=d.querySelector("."+o),_=d.querySelector(".card__like-counter");return p.src=e.link,p.alt="фотография с изображением места "+e.name,m.textContent=e.name,e.owner._id!==l._id&&f.remove(),e.likes.some((function(e){return e._id===l._id}))&&v.classList.add(a),u(v,_,e,null),d.addEventListener("click",(function t(a){var f=a.target.classList;f.contains(n)?s(m,p):f.contains(o)?u(v,_,e,l._id):f.contains(r)&&i(d,c,t,e)})),d}(e,{cardTemplate:J,removeCard:z,likeCard:H,showCard:G,currentUser:S}))},V=function e(t){if("click"===t.type&&(t.target.classList.contains("popup")||t.target.classList.contains("popup__close"))||"Escape"===t.key){var n=l($);n.form&&n.setup(),n&&u(n.popup,e)}},W=function(e){var t=function(e,t){return e.find((function(e){return t.classList.contains(e.activator)||t===e.popup}))}($,e.target);t&&!l($)&&s(t.popup,V)},$=[{activator:"profile__edit-button",popup:T,form:j,setup:function(){var e,t,n;j.elements.name.value=k.textContent,j.elements.description.value=x.textContent,e=j,t=i,n=Array.from(e.elements),(y(n)?m:p)(function(e){return Array.from(e.elements).find((function(e){return"submit"===e.type}))}(e),t.inactiveButtonClass),n.forEach((function(n){"INPUT"===n.nodeName&&v(n,t,d(e,n))}))},submit:function(e){return k.textContent=e.name,x.textContent=e.about,{form:j,name:e.name,description:e.about}},request:function(e){return g("/users/me",{method:"PATCH",headers:h.headers,body:JSON.stringify(e)})},parameters:function(){return{name:j.elements.name.value,about:j.elements.description.value}}},{activator:"profile__add-button",popup:A,form:O,setup:function(){return O.reset()},submit:function(e){R(e)},request:function(e){return g("/cards",{method:"POST",headers:h.headers,body:JSON.stringify(e)})},parameters:function(){return{name:O.elements["place-name"].value,link:O.elements.link.value}}},{activator:"profile__image",popup:N,form:B,setup:function(){return B.reset()},submit:function(e){q.style.backgroundImage='url("'.concat(e.avatar,'")')},request:function(e){return g("/users/me/avatar",{method:"PATCH",headers:h.headers,body:JSON.stringify(e)})},parameters:function(){return{avatar:B.elements.link.value}}},{activator:"card__delete-button",popup:w,form:D,setup:function(){L=null},submit:function(){return L.remove(L.cardElement,L.handle),{form:D}},request:function(e){return g("/cards/".concat(e._id),{method:"DELETE",headers:h.headers})},parameters:function(){return L.card},loading:"Удаление...",multiple:!0},{activator:"card__image",popup:I,multiple:!0}];Promise.all([g("/cards",{headers:h.headers}),g("/users/me",{headers:h.headers})]).then((function(e){var t,n,r,o,a=(o=2,function(e){if(Array.isArray(e))return e}(r=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,c=[],u=!0,s=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(c.push(r.value),c.length!==t);u=!0);}catch(e){s=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(s)throw o}}return c}}(r,o)||function(e,t){if(e){if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(e,t):void 0}}(r,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=a[0],s=a[1];t=S=s,k.textContent=t.name,x.textContent=t.about,q.style.backgroundImage='url("'.concat(t.avatar,'")'),c.forEach((function(e){R(e)})),n=i,Array.from(document.querySelectorAll(n.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.elements),r=n.find((function(e){return"submit"===e.type}));e.addEventListener("reset",(function(){n.forEach((function(n){"INPUT"===n.nodeName&&v(n,t,d(e,n))})),p(r,t.inactiveButtonClass)})),n.forEach((function(o){if("INPUT"===o.nodeName){var a=d(e,o);o.addEventListener("input",(function(){!function(e,t,n){_(e)?v(e,t,n):function(e,t,n){n.textContent=e.validationMessage,n.classList.add(t.errorClass),e.classList.add(t.inputErrorClass)}(e,t,n)}(o,t,a),y(n)?m(r,t.inactiveButtonClass):p(r,t.inactiveButtonClass)}))}}))}(e,n)})),$.forEach((function(e){e.multiple||(e.activatorElement=document.querySelector("."+e.activator),e.activatorElement.addEventListener("click",W)),e.form&&(e.setup(),e.form.addEventListener("submit",(function(t){!function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";e.preventDefault();var o=e.submitter,a=o.textContent;C(!0,o,{loadingText:r}),n().then((function(n){u(t,V),C(!1,o,{commonText:a}),n?Object.keys(n).forEach((function(e){"form"!==e&&(n.form.elements[e].value=n[e])})):e.target.reset()})).catch((function(e){console.error(e),C(!1,o,{isError:!0,errorText:e})}))}(t,e.popup,(function(){return e.request(e.parameters?e.parameters():void 0).then(e.submit)}),e.loading?e.loading:void 0)})))}))})).catch(console.error)})();