(()=>{"use strict";var e="popup_is-animated",t="popup_is-opened",n="card__like-button_is-active",r={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},o=function(e){var t=e.handleLike,n=e.handleShow,r=e.handleDelete,o=e.element,a=e.cardLike,i=e.cardImage,c=e.cardTrash;a.removeEventListener("click",t),i.removeEventListener("click",n),c.removeEventListener("click",r),o.remove()},a=function(e,n){e.classList.remove(t),e.removeEventListener("click",n),document.removeEventListener("keydown",n)},i=function(n,r){n.classList.contains(e)?n.classList.add(t):(setTimeout((function(){n.classList.add(e)}),0),setTimeout((function(){n.classList.add(t)}),10)),n.addEventListener("click",r),document.addEventListener("keydown",r)},c=function(e){return e.find((function(e){return e.popup.classList.contains(t)}))},u=function(e,t){return e.querySelector(".".concat(e.getAttribute("name"),"__").concat(t.name,"--error"))},s=function(e,t){e.hasAttribute("disabled")||(e.setAttribute("disabled",""),e.classList.add(t))},l=function(e,t){e.hasAttribute("disabled")&&(e.removeAttribute("disabled"),e.classList.remove(t))},d=function(e,t){e.setCustomValidity(t)},p=function(e,t,n){n.textContent="",n.classList.remove(t.errorClass),e.classList.remove(t.inputErrorClass)},m=function(e){return e.validity.patternMismatch?e.dataset.patternError?d(e,e.dataset.patternError):console.log("WARNING: error message for pattern is missing in the markup of the input ".concat(e.name)):d(e,""),e.validity.valid},f=function(e){return e.every((function(e){return"INPUT"!==e.nodeName||m(e)}))},v={baseUrl:"https://nomoreparties.co/v1/".concat("wff-cohort-5"),headers:{authorization:"9b1a6b52-28b2-4d5c-8007-f394db7e5a58","Content-Type":"application/json"}},_=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},h=function(e,t){return fetch("".concat(v.baseUrl).concat(e),t).then(_)},y=function(e,t,n){var r=n.commonText,o=void 0===r?"Сохранить":r,a=n.loadingText,i=void 0===a?"Сохранение...":a,c=n.isError,u=void 0!==c&&c,s=n.errorText,l=void 0===s?"ошибка":s,d=t.textContent;return u?("string"!=typeof l&&(l="ошибка"),(l="Повторить ("+l+")").length>30&&(l=l.substring(0,25)+"...)"),t.textContent=l):t.textContent=e?i:o,e?t.setAttribute("disabled",""):t.removeAttribute("disabled"),d};function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var g,C,k=document.querySelector(".profile__info .profile__title"),L=document.querySelector(".profile__info .profile__description"),E=document.querySelector(".profile__image"),S=document.querySelector(".popup_type_edit"),x=document.querySelector(".popup_type_new-card"),q=document.querySelector(".popup_type_avatar"),T=document.querySelector(".popup_type_delete-card"),A=document.querySelector(".popup_type_image"),w=document.querySelector(".popup_type_image .popup__image"),N=document.querySelector(".popup_type_image .popup__caption"),I=document.forms["edit-profile"],P=document.forms["new-place"],U=document.forms["edit-avatar"],j=document.forms["delete-card"],O=document.querySelector("#card-template").content,B=document.querySelector(".places__list"),D=function(e,t,r,o){var a;o?(t.textContent="⌛️",e.classList.contains(n)?function(e){return h("/cards/likes/".concat(e),{method:"DELETE",headers:v.headers})}(r._id).then((function(r){r.likes.some((function(e){return e._id===o}))||e.classList.remove(n),t.textContent=r.likes.length})).catch((function(e){console.error(e),t.textContent="?"})):(a=r._id,h("/cards/likes/".concat(a),{method:"PUT",headers:v.headers})).then((function(r){r.likes.some((function(e){return e._id===o}))&&e.classList.add(n),t.textContent=r.likes.length})).catch((function(e){console.error(e),t.textContent="?"}))):t.textContent=r.likes.length},M=function(e,t,n){i(T,R),(C={}).parameters=n,C.remove=t,C.card=e},H=function(e,t){var n,r,o;n=e,N.textContent=n.textContent,o=t,(r=w).src=o.src,r.alt=o.alt,i(A,R)},J=function(e){B.prepend(function(e,t){var r=t.removeCard,a=t.likeCard,i=t.showCard,c=t.currentUser,u=t.cardTemplate.querySelector(".card").cloneNode(!0),s=u.querySelector(".card__image"),l=u.querySelector(".card__title"),d=u.querySelector(".card__delete-button"),p=u.querySelector(".card__like-button"),m=u.querySelector(".card__like-counter");s.src=e.link,s.alt="фотография с изображением места "+e.name,l.textContent=e.name,e.owner._id!==c._id&&d.remove(),e.likes.some((function(e){return e._id===c._id}))&&p.classList.add(n),a(p,m,e,null);var f=function(){a(p,m,e,c._id)},v=function(){i(l,s)};return p.addEventListener("click",f),s.addEventListener("click",v),d.addEventListener("click",(function t(){r(e,o,{handleLike:f,handleShow:v,handleDelete:t,element:u,cardLike:p,cardImage:s,cardTrash:d})})),u}(e,{cardTemplate:O,removeCard:M,likeCard:D,showCard:H,currentUser:g}))},R=function e(t){if("click"===t.type&&(t.target.classList.contains("popup")||t.target.classList.contains("popup__close"))||"Escape"===t.key){var n=c(G);n.form&&n.setup(),n&&a(n.popup,e)}},z=function(e){var t=function(e,t){return e.find((function(e){return t.classList.contains(e.activator)||t===e.popup}))}(G,e.target);t&&!c(G)&&i(t.popup,R)},G=[{activator:"profile__edit-button",popup:S,form:I,setup:function(){var e,t,n;I.elements.name.value=k.textContent,I.elements.description.value=L.textContent,e=I,t=r,n=Array.from(e.elements),(f(n)?l:s)(function(e){return Array.from(e.elements).find((function(e){return"submit"===e.type}))}(e),t.inactiveButtonClass),n.forEach((function(n){"INPUT"===n.nodeName&&p(n,t,u(e,n))}))},submit:function(e){return k.textContent=e.name,L.textContent=e.about,{form:I,name:e.name,description:e.about}},request:function(e){return h("/users/me",{method:"PATCH",headers:v.headers,body:JSON.stringify(e)})},parameters:function(){return{name:I.elements.name.value,about:I.elements.description.value}}},{activator:"profile__add-button",popup:x,form:P,setup:function(){return P.reset()},submit:function(e){J(e)},request:function(e){return h("/cards",{method:"POST",headers:v.headers,body:JSON.stringify(e)})},parameters:function(){return{name:P.elements["place-name"].value,link:P.elements.link.value}}},{activator:"profile__image",popup:q,form:U,setup:function(){return U.reset()},submit:function(e){E.style.backgroundImage='url("'.concat(e.avatar,'")')},request:function(e){return h("/users/me/avatar",{method:"PATCH",headers:v.headers,body:JSON.stringify(e)})},parameters:function(){return{avatar:U.elements.link.value}}},{activator:"card__delete-button",popup:T,form:j,setup:function(){C=null},submit:function(){return C.remove(C.parameters),{form:j}},request:function(e){return h("/cards/".concat(e._id),{method:"DELETE",headers:v.headers})},parameters:function(){return C.card},loading:"Удаление...",multiple:!0},{activator:"card__image",popup:A,multiple:!0}];Promise.all([h("/cards",{headers:v.headers}),h("/users/me",{headers:v.headers})]).then((function(e){var t,n,o,i,c=(i=2,function(e){if(Array.isArray(e))return e}(o=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,c=[],u=!0,s=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(c.push(r.value),c.length!==t);u=!0);}catch(e){s=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(s)throw o}}return c}}(o,i)||function(e,t){if(e){if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(e,t):void 0}}(o,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),d=c[0],v=c[1];t=g=v,k.textContent=t.name,L.textContent=t.about,E.style.backgroundImage='url("'.concat(t.avatar,'")'),d.forEach((function(e){J(e)})),n=r,Array.from(document.querySelectorAll(n.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.elements),r=n.find((function(e){return"submit"===e.type}));e.addEventListener("reset",(function(){n.forEach((function(n){"INPUT"===n.nodeName&&p(n,t,u(e,n))})),s(r,t.inactiveButtonClass)})),n.forEach((function(o){if("INPUT"===o.nodeName){var a=u(e,o);o.addEventListener("input",(function(){!function(e,t,n){m(e)?p(e,t,n):function(e,t,n){n.textContent=e.validationMessage,n.classList.add(t.errorClass),e.classList.add(t.inputErrorClass)}(e,t,n)}(o,t,a),f(n)?l(r,t.inactiveButtonClass):s(r,t.inactiveButtonClass)}))}}))}(e,n)})),G.forEach((function(e){e.multiple||(e.activatorElement=document.querySelector("."+e.activator),e.activatorElement.addEventListener("click",z)),e.form&&(e.setup(),e.form.addEventListener("submit",(function(t){var n=function(){return e.request(e.parameters?e.parameters():void 0).then(e.submit)};!function(e,t,n){var r=n.popup,o=n.handleHide,a=n.hideModal,i=n.loadingText,c=void 0===i?"Сохранение...":i;e.preventDefault();var u=e.submitter,s=u.textContent;y(!0,u,{loadingText:c}),t().then((function(t){a(r,o),y(!1,u,{commonText:s}),t?Object.keys(t).forEach((function(e){"form"!==e&&(t.form.elements[e].value=t[e])})):e.target.reset()})).catch((function(e){console.error(e),y(!1,u,{isError:!0,errorText:e})}))}(t,n,{popup:e.popup,makeRequest:n,hideModal:a,handleHide:R,loadingText:e.loading?e.loading:void 0})})))}))})).catch(console.error)})();